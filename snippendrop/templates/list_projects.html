{% extends "base.html" %}

{% block content %}

  <h1>Snippendrop</h1>

  <h2>Your projects:</h2>
  <div class="projects">
    You have no projects. Why not add one?
  </div>

  <h2>Create a new project:</h2>
  <p>
    {{ new_project_form.name }}
    <button class="new-project">New project</button>
  </p>

  <script type="text/javascript">

  var ProjectView = Backbone.View.extend({
    tagName: 'li',
    template: _.template($('#project-template').html()),
    events: {
      'click .delete': 'delete'
    },
    initialize: function() {
      _.bindAll(this, 'render', 'delete');
      this.model.bind('change', this.render);
      this.model.view = this;
    },
    render: function() {
      $(this.el).html(this.template(this.model));
      return this;
    },
    delete: function() {
      this.model.destroy();
      this.remove();
      return false;
    }
  });

  var AppView = Bacokbone.View.extend({
    el: $('.projects'),
    events: {
      '.new-project click': newProject,

    initialize

  projects.bind('add', function(project) {
    if (!$('.projects ul').length) {
      $('.projects').empty().append('<ul/>');
    }
    var template = '<li><a href="{\{ url }\}">{\{ name }\}</a></li>';
    var context = {url: project.viewUrl(), name: project.get('name')};
    $('.projects ul').append(Mustache.to_html(template, context));
  });

  {% for obj in projects %}
  projects.add({{ obj.to_dict()|tojson|safe }});
  {% endfor %}

  $('form.new-project button').click(function() {
    var input = $('#name');
    var name = input.val();
    if (name) {
      projects.create({name: name});
    }
    input.val('');
    return false;
  });

  $('.delete').live('click', function() {
    var pid = $(this).data('pid');
    return false;
  });

  </script>

  <script type="text/template" id="project-template">
    <a href="<%= getUrl() %>"><%= name %></a>
    (<a href="#" class="delete-project" data-id="<%= id %>">X</a>)
  </script>

{% endblock %}
